---
title: 多项式曲线拟合
date: 2019-04-17      #用命令会自动生成，也可以自己写，所以文章时间可以改
categories: 抛物线，函数拟合         #文章的分类，这个可以自己定义
tags: [前端,图形计算]        #tag，为文章添加标签，方便搜索
---

## 前言

前阵子刚好看到一篇文章 [JS画出一个黑洞](https://juejin.im/entry/5caeb7cee51d456e4f4d29c7)，其实这篇文章当成天文科普文去看也是可以的，后面用 JS 画出来的实际成果也挺酷炫的，有兴趣的自行查看哈。我在读这篇文章的时候呢，也顺便研究了下图形计算库。在这个过程中竟然找到了之前业务上遇到的一个问题的解决方法了。看来读文章的同时最好多加上自己的思考，说不定会有些意外之喜哈哈。

<!-- more -->

## 实际业务问题

之前有这么一个需求，是要做一个把锤子从起点到终点一边移动一边旋转的动画，拿到这个需求，我想都没想直接用 animation 属性直接开干了。然而，真是 Too young too simple。锤子直接溢出页面，这就尴尬了。既然 animation 不可以满足需求，那我们再想想办法。网上查阅资料，可以用 SVG SMIL animation 试试。然而，SVG SMIL animation 虽然可以解决锤子溢出的问题，但也引入了新的问题，兼容性问题，SVG SMIL animation 不兼容所有版本的ie，edge，opera，很明显这个方案又被否决了。由上面文章启发，我在想是不是可以由几个点，拟合出一条曲线函数，然后再根据这条曲线渲染出动画来呢。
![业务问题](http://1.z9ls.com/t6/701/1555487338x2890186050.gif)

## 多项式曲线拟合

### 知识储备

> 多项式函数是一个很重要的建模手段，利用任意个点，就可以拟合出一个多项式函数，通过多项式函数来推导出其他点的函数值，然后绘制出函数曲线。

### 多项式函数 | F(x)

1. 形如Pn(x)= anx^n+ an-1x^(n-1)+…+ a1x+ a0的函数，叫做多项式函数，它是由常数与自变量x经过有限次乘法与加法运算得到的。显然，当n=1时，其为一次函数y=kx+b，当n=2时，其为二次函数y=ax^2+bx+c。
2. 通过点来拟合，得到拟合多项式的函数关系（一个JavaScript方法），在拟合过程中，记录中间生成的一个二维数组，用于后续计算图表值；
3. 通过高斯消元法，算出多项式函数系数值
4. 把算出来的多项式函数渲染出来

### 高斯消元法

1. 首先我们把点通过存放在数组里转换成矩阵

| a1 b1 c1 … r1 |
| a1 b2 c2 … r2 |
……
| an bn cn … rn |
2. 矩阵通过初等行变换，转换成单位矩阵，即可解出多项式函数

```shell
| a1 b1 c1 … r1 |            | 1   b1/a1  c1/a1  …  r1/a1 |
| a1 b2 c2 … r2 |            | 0   b2-b1 c2-c1  …  r2-r1 |
……                    -->     ……                                               -->
| an bn cn … rn |            | 0   bn-an*b1/a1  cn-an*c1/a1 … rn-an*r1/a1 |

| 1   0  c1/a1-b1/a1*(c2-c1/b2-b1)  …  r1/a1/-b1/a1*(c2-c1/b2-b1) |
| 0   1  c2-c1/b2-b1  …  r2-r1/b2-b1 |
……                                                                                         -->
| 0  0  cn-an*c1/a1-bn-an*b1/a1*(c2-c1/b2-b1) … rn-an*r1/a1-bn-an*b1/a1*(c2-c1/b2-b1) |

                | 1 0 0 … 0 r1 |
                | 0 1 0 … 0 r2 |
... -->          ……
                | 0 0 0 … 1 rn |
```

最终结果为 Pn(x)= r1x^n+ r2x^(n-1)+…+ rn-1x+ rn
3. 关键代码

```javascript
        // 将输入点转化为矩阵
        /**
         * | a1 b1 c1 ... r1 |
         * | a1 b2 c2 ... r2 |
         * |      ......     |
         * | an bn cn ... rn |
         */
        for (var i = 0; i < n; i++) {
            var tempArr = [];
            for (var j = 0; j < n; j++) {
                tempArr.push(Math.pow(userInput[i].x, n - j - 1));
            }
            tempArr.push(userInput[i].y);
            inputMatrix.push(tempArr);
        }
        // 高斯消元法 通过矩阵初等变换,将输入矩阵变为如下形式
        /**
         * | 1 0 0 ... 0 r1 |
         * | 0 1 0 ... 0 r2 |
         * |      ......    |
         * | 0 0 0 ... 1 rn |
         */
        for (var i = 0; i < n; i++) {
            var base = inputMatrix[i][i];

            for (var j = 0; j < n + 1; j++) {
                inputMatrix[i][j] = inputMatrix[i][j] / base;
            }

            for (var j = 0; j < n; j++) {
                if (i != j) {
                    var baseInner = inputMatrix[j][i];
                    for (var k = 0; k < n + 1; k++) {
                        inputMatrix[j][k] = inputMatrix[j][k] - baseInner * inputMatrix[i][k];
                    }
                }
            }
        }
```

4. 渲染这个多项式函数

根据上面的知识储备，我自己做了一个 demo 出来，可以由任意几个点（不能出现相同x值，y值不同的情况）推导出多项式函数，并渲染出来，[源码](https://github.com/cssie/parabolic.git)自取。

## 后续

至此，我们可以解决上面提出的业务方的问题了。同时，我们这个方案还可以应用到很多应用场景中，至于什么应用场景，就要靠我们自己去挖掘啦。

## 参考资料

- [用JavaScript实现多项式曲线拟合](https://hepeng.net/2013/03/18/javascript-fitted-curve/)
- [高斯消元法](https://zh.wikipedia.org/wiki/%E9%AB%98%E6%96%AF%E6%B6%88%E5%8E%BB%E6%B3%95)
- [在线拟合曲线](http://www.atool88.com/fitted_curve.php)
- [函数渲染库](https://www.wolframalpha.com/)
- [用JS画一个黑洞](https://juejin.im/entry/5caeb7cee51d456e4f4d29c7)
